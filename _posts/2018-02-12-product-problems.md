---
layout: post
title: 一些总结
---
CMP
---

* 单体式架构向分布式架构迁移

  * 解决性能问题。集群规模扩大后资源同步、资源创建、监控采集问题明显。使用分布式架构，分区治理。
  * 解决稳定性问题。单体式架构，某个节点异常会导致服务不可用。
  * 解决耦合度问题。团队规模扩大，系统拆分为多个相互独立的子模块，独立演进。


* 数据一致性问题

  * 定时同步和消息通知机制结合，保证CMP中的数据和底层资源池中一致。
  * 减少不必要的数据存储，CMP中的数据只保存一份，其它模块使用接口获取数据。减少不同层级之间的数据同步。

* 多租户集成问题

  * 使用openstack keystone实现多租户体系，功能类似aws iam。

* 资源调度问题

  * 产品的调度器基于YARN开发，设计为两阶段调度，筛选阶段和打分阶段。
  * 筛选阶段根据规则过滤符合要求的主机，比如根据资源池、集群或者资源标签过滤主机。
  * 打分阶段选择当前阶段最优的主机，主要考虑主机当前负载、关机虚拟机预留资源以及主机资源使用趋势。
  * 实验环境中测试过使用GA对资源做重调度，调度目标包括节能（或均衡）和最小迁移次数。

ECP
---

* 微服务划分问题

  * 模块划分太细，微服务模块太多，问题分析定位困难。合并一些只有资源CRUD操作的模块，避免过度设计。

* 功能重复问题

  * 自研的存储模块和kubernetes功能高度重复。设计时应该充分调研社区功能开发进展，即使短时间内不能支持，也要考虑如何使后期的迁移工作尽量简单。

* 监控方案问题

  * 使用CMP的监控方案集成ECP。CMP侧重监控物理机、虚拟机和设备的性能指标，ECP侧重监控应用的服务指标，改造过程中问题较多，最终也很难满足ECP的需求。

* 资源调度问题

  * 一个应用通常包含很多个组件，分布在不同的Pod中。只有所有的Pod都正常运行才能保证应用可用。在Kubernetes原生调度器的基础上开发了gang-scheduler，把多个相互关联的Pod作为一个整体调度。

  