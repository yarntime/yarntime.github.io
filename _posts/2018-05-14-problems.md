---
layout: post
title: Kubernetes集群的一些异常问题处理记录
---

1. 容器内使用service ip访问其它服务异常的问题。
   
   问题现象：

   * 从容器内部，使用service ip访问其它服务超时。直接使用其它服务的pod ip可以正常访问。

   问题原因：
   
   bridge-nf-call-iptables没有开启，iptables只能处理本机流量。

   解决方案：开启bridge-nf-call-iptables。

    ```
   sysctl net.bridge.bridge-nf-call-iptables=1
   sysctl net.bridge.bridge-nf-call-ip6tables=1
    ```

2. 平台中deployments、rc等状态异常问题。
  
   问题现象：
   * watch一个deployment或者rc资源，status中的几个pod数量异常变化。
   * 使用service访问服务，服务偶尔不可用。

   问题原因：

   设置的node-monitor-grace-period参数间隔太小，节点压力大的情况下kubelet未能及时上报健康信息，导致controller-manager认为节点异常，进一步会标记节点上的pod状态异常。

   解决方案：调整node-monitor-grace-period参数。
